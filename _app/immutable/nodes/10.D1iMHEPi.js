import"../chunks/DsnmJJEf.js";import{i as v0}from"../chunks/BVbvjRkN.js";import{p as h0,f as b,t as N,d as m,e as d0,r as n,l as e0,k as H,g as c,c as h,b as u,s as M,h as p,a as Q,j as S,ai as g0,n as r0}from"../chunks/4GbpYj1Z.js";import{d as p0,s as F}from"../chunks/BtTk71Kd.js";import{a as C,r as l0}from"../chunks/CK5eLMkr.js";import{i as R}from"../chunks/C-F78KSZ.js";import{e as o0,i as i0}from"../chunks/C_cjGUXz.js";import{s as $}from"../chunks/CG_wtlq_.js";import{s as s0}from"../chunks/B00MqyoI.js";import{g as w0,h as b0}from"../chunks/D5MljCm_.js";const y0=""+new URL("../assets/monster.Csm6RS2X.svg",import.meta.url).href,k0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23000000'%20width='800px'%20height='800px'%20viewBox='0%200%201920%201920'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M960%200C430.645%200%200%20430.645%200%20960s430.645%20960%20960%20960%20960-430.645%20960-960S1489.355%200%20960%200'%20fill-rule='evenodd'/%3e%3c/svg%3e",x0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20height='800px'%20width='800px'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20511.882%20511.882'%20xml:space='preserve'%3e%3cpolygon%20style='fill:%23F6BB42;'%20points='350.216,176.572%20278.374,158.615%2037.038,264.123%200,338.207%20125.753,374.324%20386.13,258.531%20'/%3e%3cpolygon%20style='fill:%23FFCE54;'%20points='350.216,176.572%20107.756,284.345%20125.753,374.324%20386.13,258.531%20'/%3e%3cpolygon%20style='fill:%23E8AA3D;'%20points='107.756,284.345%2037.038,264.123%200.015,338.207%20125.753,374.324%20'/%3e%3cpolygon%20style='fill:%23F6BB42;'%20points='475.969,212.682%20404.127,194.717%20162.791,300.232%20125.753,374.324%20251.504,410.41%20511.882,294.625%20'/%3e%3cpolygon%20style='fill:%23FFCE54;'%20points='475.969,212.682%20233.508,320.431%20251.504,410.41%20511.882,294.625%20'/%3e%3cpolygon%20style='fill:%23E8AA3D;'%20points='233.508,320.431%20162.791,300.232%20125.753,374.324%20251.504,410.41%20'/%3e%3cpolygon%20style='fill:%23F6BB42;'%20points='396.316,119.429%20324.488,101.473%20103.867,198.435%2066.843,272.519%20192.596,308.621%20432.245,201.379%20'/%3e%3cpolygon%20style='fill:%23FFCE54;'%20points='396.316,119.429%20174.6,218.641%20192.596,308.621%20432.245,201.379%20'/%3e%3cpolygon%20style='fill:%23E8AA3D;'%20points='174.6,218.641%20103.867,198.435%2066.843,272.519%20192.596,308.621%20'/%3e%3c/svg%3e",L0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23AFE1AF'%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3ctitle%3eheat%3c/title%3e%3cpath%20d='M7.442%2015.050c-0.726-0.745-1.38-1.566-1.948-2.448l-0.037-0.062c-0.805-1.614-1.276-3.516-1.276-5.528%200-0.901%200.095-1.78%200.274-2.628l-0.015%200.082c0.008-0.052%200.012-0.111%200.012-0.172%200-0.69-0.56-1.25-1.25-1.25-0.641%200-1.17%200.483-1.242%201.105l-0.001%200.006c-0.179%200.868-0.282%201.865-0.282%202.886%200%202.465%200.599%204.79%201.658%206.838l-0.039-0.083c0.695%201.103%201.451%202.062%202.296%202.934l-0.005-0.005c0.597%200.626%201.157%201.301%201.67%202.013l0.039%200.056c0.993%201.53%201.584%203.402%201.584%205.411%200%201.078-0.17%202.116-0.485%203.090l0.020-0.071c-0.036%200.111-0.056%200.238-0.056%200.371%200%200.558%200.365%201.030%200.87%201.191l0.009%200.002c0.11%200.036%200.237%200.057%200.369%200.057%200.001%200%200.002%200%200.003%200h-0c0.558-0%201.030-0.366%201.191-0.87l0.002-0.009c0.374-1.129%200.589-2.429%200.589-3.779%200-2.528-0.756-4.88-2.053-6.841l0.029%200.046c-0.622-0.871-1.253-1.636-1.934-2.354l0.009%200.010zM16.897%2015.11c-0.884-0.907-1.68-1.907-2.371-2.982l-0.045-0.075c-0.988-1.972-1.566-4.298-1.566-6.758%200-1.093%200.114-2.159%200.331-3.187l-0.018%200.1c0.005-0.043%200.008-0.093%200.008-0.144%200-0.69-0.56-1.25-1.25-1.25-0.632%200-1.154%200.469-1.238%201.077l-0.001%200.007c-0.214%201.031-0.336%202.215-0.336%203.428%200%202.914%200.706%205.662%201.956%208.085l-0.046-0.099c0.827%201.309%201.725%202.446%202.727%203.481l-0.005-0.006c0.722%200.758%201.401%201.576%202.023%202.438l0.047%200.069c1.217%201.877%201.941%204.171%201.941%206.635%200%201.32-0.208%202.592-0.593%203.784l0.024-0.087c-0.036%200.111-0.056%200.238-0.056%200.371%200%200.558%200.365%201.030%200.87%201.191l0.009%200.002c0.11%200.036%200.237%200.057%200.368%200.057%200.001%200%200.002%200%200.003%200h-0c0.558-0%201.030-0.366%201.191-0.87l0.002-0.009c0.441-1.333%200.695-2.867%200.695-4.461%200-2.982-0.89-5.755-2.418-8.070l0.034%200.055c-0.739-1.034-1.489-1.941-2.297-2.794l0.011%200.012zM28.24%2017.594c-0.621-0.87-1.253-1.634-1.933-2.351l0.009%200.009c-0.726-0.746-1.381-1.568-1.949-2.451l-0.037-0.062c-0.801-1.622-1.269-3.532-1.269-5.55%200-0.893%200.092-1.764%200.266-2.606l-0.014%200.083c0.006-0.047%200.010-0.1%200.010-0.155%200-0.635-0.474-1.16-1.087-1.24l-0.006-0.001c-0.043-0.005-0.093-0.008-0.144-0.008-0.638%200-1.165%200.472-1.252%201.087l-0.001%200.007c-0.174%200.859-0.273%201.847-0.273%202.858%200%202.474%200.595%204.808%201.651%206.868l-0.040-0.085c0.696%201.104%201.452%202.064%202.297%202.936l-0.005-0.005c0.595%200.625%201.155%201.3%201.668%202.010l0.039%200.057c0.993%201.53%201.584%203.402%201.584%205.411%200%201.078-0.17%202.116-0.484%203.089l0.020-0.071c-0.036%200.111-0.056%200.238-0.056%200.371%200%200.558%200.365%201.030%200.87%201.191l0.009%200.002c0.11%200.036%200.237%200.057%200.368%200.057%200.001%200%200.002%200%200.003%200h-0c0.558-0%201.030-0.366%201.191-0.87l0.002-0.009c0.373-1.129%200.589-2.428%200.589-3.778%200-2.528-0.755-4.88-2.053-6.842l0.029%200.046z'%3e%3c/path%3e%3c/svg%3e",C0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M2.5%205.5L3.11612%206.11612C3.68206%206.68206%204.44964%207%205.25%207C6.05036%207%206.81794%206.68206%207.38388%206.11612L7.61612%205.88388C8.18206%205.31794%208.94964%205%209.75%205C10.5504%205%2011.3179%205.31794%2011.8839%205.88388L12.1161%206.11612C12.6821%206.68206%2013.4496%207%2014.25%207C15.0504%207%2015.8179%206.68206%2016.3839%206.11612L16.6161%205.88388C17.1821%205.31794%2017.9496%205%2018.75%205C19.5504%205%2020.3179%205.31794%2020.8839%205.88388L21.5%206.5M2.5%2011.5L3.11612%2012.1161C3.68206%2012.6821%204.44964%2013%205.25%2013C6.05036%2013%206.81794%2012.6821%207.38388%2012.1161L7.61612%2011.8839C8.18206%2011.3179%208.94964%2011%209.75%2011C10.5504%2011%2011.3179%2011.3179%2011.8839%2011.8839L12.1161%2012.1161C12.6821%2012.6821%2013.4496%2013%2014.25%2013C15.0504%2013%2015.8179%2012.6821%2016.3839%2012.1161L16.6161%2011.8839C17.1821%2011.3179%2017.9496%2011%2018.75%2011C19.5504%2011%2020.3179%2011.3179%2020.8839%2011.8839L21.5%2012.5M2.5%2017.5L3.11612%2018.1161C3.68206%2018.6821%204.44964%2019%205.25%2019C6.05036%2019%206.81794%2018.6821%207.38388%2018.1161L7.61612%2017.8839C8.18206%2017.3179%208.94964%2017%209.75%2017C10.5504%2017%2011.3179%2017.3179%2011.8839%2017.8839L12.1161%2018.1161C12.6821%2018.6821%2013.4496%2019%2014.25%2019C15.0504%2019%2015.8179%2018.6821%2016.3839%2018.1161L16.6161%2017.8839C17.1821%2017.3179%2017.9496%2017%2018.75%2017C19.5504%2017%2020.3179%2017.3179%2020.8839%2017.8839L21.5%2018.5'%20stroke='lightblue'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",N0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%20128%20128'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--noto'%20preserveAspectRatio='xMidYMid%20meet'%3e%3cpath%20d='M121.59%2060.83l-13.93-4.49c-8.91-2.94-14.13-10.15-16.58-19.21L84.95%207.27c-.16-.59-.55-1.38-1.75-1.38c-1.01%200-1.59.79-1.75%201.38l-6.13%2029.87c-2.46%209.06-7.67%2016.27-16.58%2019.21l-13.93%204.49c-1.97.64-2%203.42-.04%204.09l14.03%204.83c8.88%202.95%2014.06%2010.15%2016.52%2019.17l6.14%2029.53c.16.59.49%201.65%201.75%201.65c1.33%200%201.59-1.06%201.75-1.65l6.14-29.53c2.46-9.03%207.64-16.23%2016.52-19.17l14.03-4.83c1.94-.68%201.91-3.46-.06-4.1z'%20fill='%23fdd835'%3e%3c/path%3e%3cpath%20d='M122.91%2062.08c-.22-.55-.65-1.03-1.32-1.25l-13.93-4.49c-8.91-2.94-14.13-10.15-16.58-19.21L84.95%207.27c-.09-.34-.41-.96-.78-1.14l1.98%2029.97c1.47%2013.68%202.73%2020.12%2013.65%2022c9.38%201.62%2020.23%203.48%2023.11%203.98z'%20fill='%23ffee58'%3e%3c/path%3e%3cpath%20d='M122.94%2063.64l-24.16%205.54c-8.51%202.16-13.2%207.09-13.2%2019.99l-2.37%2030.94c.81-.08%201.47-.52%201.75-1.65l6.14-29.53c2.46-9.03%207.64-16.23%2016.52-19.17l14.03-4.83c.66-.24%201.08-.73%201.29-1.29z'%20fill='%23f4b400'%3e%3c/path%3e%3cg%3e%3cpath%20d='M41.81%2086.81c-8.33-2.75-9.09-5.85-10.49-11.08l-3.49-12.24c-.21-.79-2.27-.79-2.49%200L22.97%2074.8c-1.41%205.21-4.41%209.35-9.53%2011.04l-8.16%203.54c-1.13.37-1.15%201.97-.02%202.35l8.22%202.91c5.1%201.69%208.08%205.83%209.5%2011.02l2.37%2010.82c.22.79%202.27.79%202.48%200l2.78-10.77c1.41-5.22%203.57-9.37%2010.5-11.07l7.72-2.91c1.13-.39%201.12-1.99-.02-2.36l-7-2.56z'%20fill='%23fdd835'%3e%3c/path%3e%3cpath%20d='M28.49%2075.55c.85%207.86%201.28%2010.04%207.65%2011.67l13.27%202.59c-.14-.19-.34-.35-.61-.43l-7-2.57c-7.31-2.5-9.33-5.68-10.7-12.04c-1.37-6.36-2.83-10.51-2.83-10.51c-.51-1.37-1.24-1.3-1.24-1.3l1.46%2012.59z'%20fill='%23ffee58'%3e%3c/path%3e%3cpath%20d='M28.73%20102.99c0-7.41%204.05-11.08%2010.49-11.08l10.02-.41s-.58.77-1.59%201.01l-6.54%202.13c-5.55%202.23-8.08%203.35-9.8%2010.94c0%200-2.22%208.83-2.64%209.76c-.58%201.3-1.27%201.57-1.27%201.57l1.33-13.92z'%20fill='%23f4b400'%3e%3c/path%3e%3c/g%3e%3cpath%20d='M59.74%2028.14c.56-.19.54-.99-.03-1.15l-7.72-2.08a4.77%204.77%200%200%201-3.34-3.3L45.61%209.06c-.15-.61-1.02-.61-1.17.01l-2.86%2012.5a4.734%204.734%200%200%201-3.4%203.37l-7.67%201.99c-.57.15-.61.95-.05%201.15l8.09%202.8c1.45.5%202.57%201.68%203.01%203.15l2.89%2011.59c.15.6%201.01.61%201.16%200l2.99-11.63a4.773%204.773%200%200%201%203.04-3.13l8.1-2.72z'%20fill='%23f4b400'%20stroke='%23f4b400'%20stroke-miterlimit='10'%3e%3c/path%3e%3c/svg%3e",R0=""+new URL("../assets/knight.LCfEOlpc.svg",import.meta.url).href,T0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='-6%20-2%2070%2074'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--emojione-monotone'%20preserveAspectRatio='xMidYMid%20meet'%3e%3cg%20stroke='white'%20stroke-width='10'%20paint-order='stroke%20fill'%3e%3cpath%20d='M16.726%2025.981c0%202.318%202.036%204.194%204.548%204.194c.237%200%20.47-.016.698-.049c-.286.655-.62%201.469-.698%201.877c-.335%201.721%201.537%203.166%203.432%203.166c0%200%20.917.076%201.114-.104c.709-.654%200-3.593%200-3.593c0-.496.436-.897.974-.897c.536%200%20.97.401.97.897c0%200-.707%203.043%200%203.697c.578.532%202.688.532%203.265%200c.709-.654%200-3.697%200-3.697c0-.496.437-.897.972-.897s.972.401.972.897c0%200-.709%203.043%200%203.697c.576.532%202.687.532%203.263%200c.709-.654%200-3.697%200-3.697c0-.496.436-.897.972-.897c.538%200%20.972.401.972.897c0%200-.709%202.938%200%203.593c.197.181%201.116.104%201.116.104c1.896%200%203.766-1.445%203.433-3.166c-.078-.408-.412-1.222-.7-1.877c.228.033.463.049.7.049c2.512%200%204.548-1.876%204.548-4.194c0-1.35-.69-2.549-1.765-3.316a13.16%2013.16%200%200%200%201.765-6.577C47.274%208.309%2040.437%202%2032%202S16.726%208.309%2016.726%2016.088c0%202.377.639%204.614%201.765%206.577c-1.074.768-1.765%201.967-1.765%203.316m26.195-8.752c3.681.203-.769%205.066-2.486%206.227c-1.716%201.161-5.839-.999-5.601-2.407c.353-2.07%205.819-3.945%208.087-3.82m-12.304%208.472c.541-.946.814-1.804%201.479-1.804s.937.857%201.48%201.804c.467.814%201.797%201.415.995%202.153c-.875.808-4.078.808-4.953%200c-.819-.755.53-1.338.999-2.153m-9.343-8.472c2.265-.125%207.734%201.75%208.086%203.819c.239%201.408-3.885%203.568-5.601%202.407c-1.716-1.159-6.167-6.022-2.485-6.226'%20fill='%23000000'%3e%3c/path%3e%3cpath%20d='M57.684%2050.325c-2.099-1.119-3.493-.295-3.493-.295c-1.442.85-3.829.901-5.312.111l-11.44-6.091l11.439-6.092c1.482-.787%203.871-.737%205.312.112c0%200%201.395.822%203.493-.295c2.214-1.18%202.975-3.792%201.695-5.838l-.424-.674c-.699-.488-1.361-1.547-1.471-2.353l-.423-.674c-1.279-2.044-4.112-2.743-6.329-1.563c-2.099%201.116-2.021%202.642-2.021%202.642c.076%201.577-1.07%203.511-2.551%204.298L32%2041.153l-14.161-7.54c-1.48-.787-2.628-2.721-2.55-4.298c0%200%20.077-1.525-2.021-2.642c-2.217-1.18-5.051-.48-6.33%201.563l-.422.674c-.11.806-.771%201.864-1.473%202.353l-.421.674c-1.28%202.046-.52%204.658%201.696%205.838c2.097%201.118%203.492.295%203.492.295c1.44-.85%203.83-.899%205.31-.112l11.441%206.092l-11.441%206.092c-1.48.79-3.87.738-5.31-.111c0%200-1.395-.824-3.492.295c-2.215%201.179-2.976%203.794-1.696%205.837l.421.674c.701.489%201.363%201.548%201.473%202.354l.422.674c1.278%202.043%204.113%202.744%206.33%201.563c2.099-1.117%202.021-2.643%202.021-2.643c-.078-1.574%201.07-3.51%202.55-4.297L32%2046.947l14.16%207.54c1.48.787%202.627%202.723%202.551%204.297c0%200-.077%201.525%202.021%202.643c2.217%201.181%205.05.479%206.329-1.563l.423-.674c.109-.806.771-1.864%201.471-2.354l.424-.674c1.279-2.043.518-4.658-1.695-5.837'%20fill='%23000000'%3e%3c/path%3e%3c/g%3e%3c/svg%3e";var A0=b('<img class="jitter drop-shadow-md" alt="W"/>'),M0=b('<img alt="P"/>'),$0=b('<img class="h-full w-full object-contain drop-shadow-md" alt="P"/>'),j0=b('<img class="glitter h-full w-full object-contain" alt="G"/>'),I0=b('<img class="wiggle h-full w-full object-contain" alt="B"/>'),D0=b('<img class="waft h-full w-full object-contain" alt="S"/>'),O0=b('<div class="grid grid-cols-[repeat(auto-fit,minmax(0,1fr))]"><!> <!> <!> <!></div>'),S0=b('<div class="absolute flex h-full w-full flex-col items-center justify-center"><img class="w-1/2 drop-shadow-md" alt="K"/></div>'),F0=b('<div class="absolute flex h-full w-full flex-col items-center justify-center"><img class="w-1/2 drop-shadow-md" alt="K"/></div>'),B0=b('<div class="w-5/6"><!></div> <!>',1),E0=b('<div class="h-full w-full bg-gray-800 blur-md"></div>'),G0=b('<div class="relative flex flex-row items-center justify-center border-1"><!></div>'),z0=b('<div class="grid aspect-square w-full grid-flow-col border"></div>');function P0(r,t){h0(t,!0);var e=z0();o0(e,21,()=>t.world.grid,i0,(s,o,a)=>{var l=e0(),i=H(l);o0(i,17,()=>c(o),i0,(f,d,y)=>{var D=G0(),W=h(D);{var V=T=>{var A=B0(),E=H(A),K=h(E);{var q=w=>{var k=A0();N(()=>$(k,"src",y0)),m(w,k)},G=w=>{var k=e0(),z=H(k);{var j=v=>{var _=M0();N(()=>$(_,"src",k0)),m(v,_)},O=v=>{var _=O0(),x=h(_);{var I=g=>{var L=$0();N(()=>$(L,"src",x0)),m(g,L)};R(x,g=>{c(d).Treasure&&g(I)})}var P=u(x,2);{var X=g=>{var L=j0();N(()=>$(L,"src",N0)),m(g,L)};R(P,g=>{c(d).Glitter&&g(X)})}var Y=u(P,2);{var f0=g=>{var L=I0();N(()=>$(L,"src",C0)),m(g,L)};R(Y,g=>{c(d).Breeze&&g(f0)})}var _0=u(Y,2);{var m0=g=>{var L=D0();N(()=>$(L,"src",L0)),m(g,L)};R(_0,g=>{c(d).Stench&&g(m0)})}n(_),m(v,_)};R(z,v=>{c(d).Pit?v(j):v(O,!1)},!0)}m(w,k)};R(K,w=>{c(d).Wumpus?w(q):w(G,!1)})}n(E);var J=u(E,2);{var t0=w=>{var k=e0(),z=H(k);{var j=v=>{var _=S0(),x=h(_);n(_),N(I=>{s0(x,`rotate: ${I??""}deg;`),$(x,"src",T0)},[()=>C(-25,25)]),m(v,_)},O=v=>{var _=F0(),x=h(_);n(_),N(I=>{s0(x,`rotate: ${I??""}deg;`),$(x,"src",R0)},[()=>C(-25,25)]),m(v,_)};R(z,v=>{t.world.is_dead?v(j):v(O,!1)})}m(w,k)};R(J,w=>{a===t.world.hero.x&&y===t.world.hero.y&&w(t0)})}m(T,A)},U=T=>{var A=E0();m(T,A)};R(W,T=>{c(d).discovered?T(V):T(U,!1)})}n(D),m(f,D)}),m(s,l)}),n(e),N(()=>s0(e,`grid-template-columns: repeat(${t.world.size??""}, minmax(0, 1fr)); grid-template-rows: repeat(${t.world.size??""}, minmax(0, 1fr));`)),m(r,e),d0()}class W0{lookup=["*"];constructor(){}lit(t,e=!1){const s=this.lookup.indexOf(t);if(s>0)return{kind:"LITERAL",value:e?-s:s};this.lookup.push(t);const o=this.lookup.length-1;return{kind:"LITERAL",value:e?-o:o}}not(t){return this.lit(t,!0)}resolve_name(t){return(t<0?"¬¨":"")+this.lookup[Math.abs(t)]}convert_to_CNF(t){if(t.kind==="TERM")return this.convert_to_CNF(t.symbol);const e=[];if(t.kind!=="AND")throw`Couldn't convert ${this.format(t)} to CNF!`;for(const s of t.symbols){let o;switch(s.kind){case"LITERAL":o=new Set([s.value]);break;case"OR":o=new Set(s.symbols.map(a=>{if(a.kind!=="LITERAL")throw"Disallowed!";return a.value}));break;case"NOT":case"AND":case"IMPL":case"BICOND":case"TERM":throw`${s.kind} disallowed when creating CNF!`}n0(e,o)||e.push(o)}return{kind:"CNF",clauses:e}}convert_to_AND(t){const e={kind:"AND",symbols:[]};for(const s of t.clauses){const o={kind:"OR",symbols:[]};for(const a of s.values())o.symbols.push({kind:"LITERAL",value:a});e.symbols.push(o)}return e}resolution(t,e){const s=this.convert_to_CNF(this.expand_dependend_exprs(c0(B(t,V0(e)))));return this.CNF_resolution(s)}CNF_resolution(t){const e=[...t.clauses];let s=[];for(;;){for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const l=e[o],i=e[a],f=X0(l,i);for(const d of f)if(n0(e,d)||s.push(d),d.size===0)return e.push,{result:!0,cnf:{kind:"CNF",clauses:e}}}if(s.length===0)return{result:!1,cnf:{kind:"CNF",clauses:e}};e.push(...s),s=[]}}format(t){switch(t.kind){case"TERM":return`${this.format(t.symbol)}`;case"LITERAL":return`${this.resolve_name(t.value)}`;case"NOT":return`¬¨ ${this.format(t.symbol)}`;case"AND":return t.symbols.length===1?this.format(t.symbols[0]):`(${t.symbols.map(e=>this.format(e)).join(" ‚àß ")})`;case"OR":return t.symbols.length===1?this.format(t.symbols[0]):`(${t.symbols.map(e=>this.format(e)).join(" ‚à® ")})`;case"IMPL":return`(${this.format(t.left)} ‚áí ${this.format(t.right)})`;case"BICOND":return`(${this.format(t.left)} ‚áî ${this.format(t.right)})`;case"CNF":return`[${t.clauses.map(e=>"["+[...e].map(s=>this.resolve_name(s)).join(" ‚à® ")+"]").join(", ")}]`}}short_format(t){switch(t.kind){case"TERM":return`${this.short_format(t.symbol)}`;case"LITERAL":return`${this.resolve_name(t.value)}`;case"NOT":return`¬¨ ${this.short_format(t.symbol)}`;case"AND":return t.symbols.length===1?this.short_format(t.symbols[0]):`(${t.symbols.map(e=>this.short_format(e)).join(", ")})`;case"OR":return t.symbols.length===1?this.short_format(t.symbols[0]):`(${t.symbols.map(e=>this.short_format(e)).join("|")})`;case"IMPL":return`(${this.short_format(t.left)} ‚áí ${this.short_format(t.right)})`;case"BICOND":return`(${this.short_format(t.left)} ‚áî ${this.short_format(t.right)})`;case"CNF":return`[${t.clauses.map(e=>"["+[...e].map(s=>this.resolve_name(s)).join("|")+"]").join(", ")}]`}}format_each_expr(t){return[...t].map(e=>this.format(e)).join(", ")}expand_again(t,e,s){t&&(console.log("..".repeat(s)+this.format(e)),this.expand_dependend_exprs(e,s+1))}expand_to_CNF(t){return this.expand_dependend_exprs(c0(Q0(t)))}expand_to_AND(t){return this.convert_to_AND(this.convert_to_CNF(this.expand_to_CNF(t)))}expand_dependend_exprs(t,e=0){switch(t.kind){case"LITERAL":break;case"AND":case"OR":for(let l=0;l<t.symbols.length;l++){this.expand_dependend_exprs(t.symbols[l],e+1);const i=Z(t.symbols[l]);t.symbols[l]=i.expr,this.expand_again(i.changed,t,e)}break;case"IMPL":case"BICOND":this.expand_dependend_exprs(t.left,e+1),this.expand_dependend_exprs(t.right,e+1);const s=Z(t.left),o=Z(t.right);this.expand_again(s.changed||o.changed,t,e);break;case"NOT":case"TERM":this.expand_dependend_exprs(t.symbol,e+1);const a=Z(t.symbol);t.symbol=a.expr,this.expand_again(a.changed,t,e);break}return t}}function V0(r){return{kind:"NOT",symbol:r}}function B(...r){return{kind:"AND",symbols:r}}function U0(...r){return{kind:"OR",symbols:r}}function K0(r,t){return{kind:"BICOND",left:r,right:t}}function c0(r){return{kind:"TERM",symbol:r}}function Z(r){switch(r.kind){case"LITERAL":return{changed:!1,expr:r};case"NOT":{const t=r.symbol;switch(t.kind){case"LITERAL":return{changed:!0,expr:{kind:"LITERAL",value:-t.value}};case"NOT":return{changed:!0,expr:t.symbol};case"AND":case"OR":const e=[];for(const s of t.symbols)e.push({kind:"NOT",symbol:s});return{changed:!0,expr:{kind:t.kind==="AND"?"OR":"AND",symbols:e}};case"IMPL":case"BICOND":return{changed:!1,expr:r};case"TERM":return r.symbol=t.symbol,{changed:!0,expr:r}}}case"AND":case"OR":{let t=!1;const e=[];for(const s of r.symbols)s.kind===r.kind?(t=!0,e.push(...s.symbols)):e.push(s);return r.symbols=e,!t&&r.kind==="OR"?{changed:!1,expr:J0(r)}:{changed:t,expr:r}}case"IMPL":{const t=r.left,e=r.right;return{changed:!0,expr:{kind:"OR",symbols:[{kind:"NOT",symbol:t},e]}}}case"BICOND":{const t=r.left,e=r.right;return{changed:!0,expr:{kind:"AND",symbols:[{kind:"IMPL",left:t,right:e},{kind:"IMPL",left:e,right:t}]}}}case"TERM":return{changed:!1,expr:r.symbol}}}function q0(r){if(r.kind!=="OR")return!1;for(const t of r.symbols)if(t.kind!=="LITERAL")return!1;return!0}function J0(r){if(q0(r))return r;let t=a0(r.symbols[0]);for(let s=1;s<r.symbols.length;s++){const o=r.symbols[s],a=a0(o),l={kind:"AND",symbols:[]};for(const i of t.symbols)for(const f of a.symbols)l.symbols.push({kind:"OR",symbols:[i,f]});t=l}let e;return t.symbols.length===1?e=t.symbols[0]:e=t,e}function a0(r){return r.kind==="AND"?r:{kind:"AND",symbols:[r]}}function X0(r,t){const e=[];for(let s of r)if(t.has(-s)){const o=r.difference(new Set([s])).union(t.difference(new Set([-s])));Y0(o)||e.push(o)}return e}function Y0(r){for(let t of r)for(let e of r)if(t===-e)return!0;return!1}function H0(r,t){if(r.size!==t.size)return!1;for(const e of r)if(!t.has(e))return!1;return!0}function n0(r,t){for(const e of r)if(H0(e,t))return!0;return!1}function Q0(r){return JSON.parse(JSON.stringify(r))}class u0{#t=M(5);get size(){return c(this.#t)}set size(t){p(this.#t,t,!0)}#e=M(Q([]));get grid(){return c(this.#e)}set grid(t){p(this.#e,t,!0)}#s=M(Q(new W0));get ctx(){return c(this.#s)}set ctx(t){p(this.#s,t,!0)}#r=M(Q({x:0,y:0}));get hero(){return c(this.#r)}set hero(t){p(this.#r,t,!0)}#l=M(Q({kind:"AND",symbols:[]}));get hero_kb(){return c(this.#l)}set hero_kb(t){p(this.#l,t,!0)}#o=S(()=>this.ctx.short_format(this.hero_kb));get hero_kb_text(){return c(this.#o)}set hero_kb_text(t){p(this.#o,t)}#i=M(!1);get treasure_collected(){return c(this.#i)}set treasure_collected(t){p(this.#i,t,!0)}#c=M(!1);get fell_in_hole(){return c(this.#c)}set fell_in_hole(t){p(this.#c,t,!0)}#a=M(!1);get died_to_wumpus(){return c(this.#a)}set died_to_wumpus(t){p(this.#a,t,!0)}get is_dead(){return this.fell_in_hole||this.died_to_wumpus}set is_dead(t){t||(this.fell_in_hole=t,this.died_to_wumpus=t)}#n=S(()=>this.get_cell(this.hero.x,this.hero.y));get local_cell(){return c(this.#n)}set local_cell(t){p(this.#n,t)}#h=S(()=>this.ctx.format(this.local_cell.rules));get local_rule(){return c(this.#h)}set local_rule(t){p(this.#h,t)}#d=S(()=>this.ctx.format(this.local_cell.state));get local_state(){return c(this.#d)}set local_state(t){p(this.#d,t)}#u=S(()=>this.ctx.format(this.ctx.expand_to_CNF(B(this.local_cell.rules,this.hero_kb))));get local_cnf(){return c(this.#u)}set local_cnf(t){p(this.#u,t)}#f=S(()=>this.get_adjacent_literals(this.hero.x,this.hero.y));get test_literals(){return c(this.#f)}set test_literals(t){p(this.#f,t)}constructor(t){this.size=t;const e=C(0,t),s=C(0,t);let o=C(0,t),a=C(0,t);o===e&&a===s&&(l0(0,1)>.5?o+=1-C(0,1)*2:a+=1-C(0,1)*2);for(let l=0;l<t;l++){this.grid.push([]);for(let i=0;i<t;i++)this.grid[l].push({Wumpus:l===e&&i===s,Treasure:l===o&&i===a,Pit:l!==e&&i!==s&&l!==o&&i!==a&&l0(0,1)>.6,Glitter:!1,Breeze:!1,Stench:!1,rules:B(),state:B(),discovered:!1})}for(let l=0;l<t;l++)for(let i=0;i<t;i++)this.grid[l][i].Wumpus?this.set_adjacent(l,i,"Stench",!0):this.grid[l][i].Pit?this.set_adjacent(l,i,"Breeze",!0):this.grid[l][i].Treasure&&this.set_adjacent(l,i,"Glitter",!0);for(let l=0;l<t;l++)for(let i=0;i<t;i++){const f=this.get_cell(l,i),d=[],y=[];d.push(this.create_adjacent_rule("B","P",l,i)),d.push(this.create_adjacent_rule("G","T",l,i)),d.push(this.create_adjacent_rule("S","W",l,i)),y.push(this.ctx.lit(`B${l}${i}`,!f.Breeze)),y.push(this.ctx.lit(`S${l}${i}`,!f.Stench)),y.push(this.ctx.lit(`G${l}${i}`,!f.Glitter)),y.push(this.ctx.lit(`P${l}${i}`,!f.Pit)),y.push(this.ctx.lit(`W${l}${i}`,!f.Wumpus)),y.push(this.ctx.lit(`T${l}${i}`,!f.Treasure)),this.grid[l][i].rules=B(...d),this.grid[l][i].state=B(...y)}for(let l=0;l<1e3;l++){const i=C(0,t),f=C(0,t),d=this.get_cell(i,f);d.Wumpus||d.Treasure||d.Pit||d.Breeze||d.Stench||(this.hero.x=i,this.hero.y=f)}this.observe()}create_adjacent_rule(t,e,s,o){const a=this.ctx.lit(`${t}${s}${o}`),l=[];return s>0&&l.push(this.ctx.lit(`${e}${s-1}${o}`)),s<this.size-1&&l.push(this.ctx.lit(`${e}${s+1}${o}`)),o>0&&l.push(this.ctx.lit(`${e}${s}${o-1}`)),o<this.size-1&&l.push(this.ctx.lit(`${e}${s}${o+1}`)),K0(a,U0(...l))}observe(){const t=this.get_cell(this.hero.x,this.hero.y);t.discovered=!0,t.Wumpus&&(this.died_to_wumpus=!0),t.Pit&&(this.fell_in_hole=!0),t.Treasure&&(this.treasure_collected=!0),this.hero_kb.symbols.push(...this.local_cell.state.symbols),this.hero_kb=this.ctx.expand_to_AND(this.hero_kb)}leave(){const t=this.get_cell(this.hero.x,this.hero.y);t.Treasure&&(t.Treasure=!1)}move(t,e){this.is_dead||(this.leave(),this.hero=w0(b0(this.hero,{x:t,y:e}),0,this.size-1,0,this.size-1),this.observe())}move_left(){this.move(-1,0)}move_right(){this.move(1,0)}move_up(){this.move(0,-1)}move_down(){this.move(0,1)}set_adjacent(t,e,s,o){for(const a of[t-1,t+1]){const l=this.get_cell(a,e);l&&(l[s]=o)}for(const a of[e-1,e+1]){const l=this.get_cell(t,a);l&&(l[s]=o)}}get_cell(t,e){if(t<0||e<0)return;const s=this.grid.at(t);return s===void 0?void 0:s.at(e)}get_adjacent_literals(t,e){return[]}}function Z0(r,t){p(t,new u0(C(4,8)))}var t2=(r,t)=>c(t).move_up(),e2=(r,t)=>c(t).move_left(),s2=(r,t)=>c(t).move_right(),r2=(r,t)=>c(t).move_down(),l2=b('<div class="grid grid-cols-2 gap-5 p-2"><div class="flex flex-col gap-2"><h1>Wumpus world | <a href="../">back</a></h1> <div class="flex flex-row gap-2"><div class="light-border"> </div> <div class="light-border"> </div></div> <div class="flex flex-row"><div class="grid grid-cols-3 grid-rows-3"><div></div> <button class="border">up</button> <div></div> <button class="border">left</button> <div></div> <button class="border">right</button> <div></div> <button class="border">down</button> <div></div></div></div> <div class="flex flex-row items-center"><button class="border">reset</button></div> <table><tbody><tr><th>Hero KB</th><td> </td></tr><tr><th>Local rules</th><td> </td></tr><tr><th>Current observation</th><td> </td></tr><tr><th>Local hero CNF</th><td> </td></tr></tbody></table> <div class="pr-2 pl-2">Test:</div></div> <div class="flex flex-col items-center"><div class="w-8/9"><!></div></div></div>');function m2(r,t){h0(t,!1);let e=g0(new u0(4));v0();var s=l2(),o=h(s),a=u(h(o),2),l=h(a),i=h(l);n(l);var f=u(l,2),d=h(f,!0);n(f),n(a);var y=u(a,2),D=h(y),W=u(h(D),2);W.__click=[t2,e];var V=u(W,4);V.__click=[e2,e];var U=u(V,4);U.__click=[s2,e];var T=u(U,4);T.__click=[r2,e],r0(2),n(D),n(y);var A=u(y,2),E=h(A);E.__click=[Z0,e],n(A);var K=u(A,2),q=h(K),G=h(q),J=u(h(G)),t0=h(J,!0);n(J),n(G);var w=u(G),k=u(h(w)),z=h(k,!0);n(k),n(w);var j=u(w),O=u(h(j)),v=h(O,!0);n(O),n(j);var _=u(j),x=u(h(_)),I=h(x,!0);n(x),n(_),n(q),n(K),r0(2),n(o);var P=u(o,2),X=h(P),Y=h(X);P0(Y,{get world(){return c(e)}}),n(X),n(P),n(s),N(()=>{F(i,`${c(e).is_dead?"üíÄ":"‚ô•Ô∏è"}
				${c(e).fell_in_hole?"Fell into pit":c(e).died_to_wumpus?"Died to Wumpus":"Alive"}`),F(d,c(e).treasure_collected?"ü™ô Treasure found!":"‚ùì Find the treasure!"),F(t0,c(e).hero_kb_text),F(z,c(e).local_rule),F(v,c(e).local_state),F(I,c(e).local_cnf)}),m(r,s),d0()}p0(["click"]);export{m2 as component};
